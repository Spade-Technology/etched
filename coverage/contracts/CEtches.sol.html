<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/CEtches.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> CEtches.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">77.5% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>31/40</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>13/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">64.29% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>9/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>33/44</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;
&nbsp;
import "@openzeppelin/contracts/utils/Counters.sol";
&nbsp;
import "./forks/ERC721.sol";
import "./ITeams.sol";
import "./IEtches.sol";
&nbsp;
import "./CNodeHandler.sol";
&nbsp;
import "hardhat/console.sol";
&nbsp;
contract Etches is ERC721, IEtches, NodeHandler {
    using Counters for Counters.Counter;
&nbsp;
    // The total number of Etches minted
    Counters.Counter private totalSupply;
&nbsp;
    // The address of the Teams contract
    address public teams;
&nbsp;
    // Mapping of Etch ID to Team ID
    mapping(uint256 etch =&gt; uint256 team) public teamOf;
&nbsp;
    // External Individual Permissions
    mapping(uint256 etch =&gt; mapping(address user =&gt; ITeams.EPermissions permission)) public individualPermissionsOf;
&nbsp;
    // External Team Permissions
    mapping(uint256 etch =&gt; ExternalTeamPermission[]) public teamPermissionsOf;
    mapping(uint256 etch =&gt; mapping(uint256 team =&gt; uint256 index)) public indexOfTeamPermissionsOf; // Index for Mapping like array structure
&nbsp;
    // Mapping of Etch Id to the Etch's metadata
    mapping(uint256 etch =&gt; SEtch metadata) public metadataOf;
    mapping(uint256 etch =&gt; SComments comments) commentsOf;
&nbsp;
    /**
     * @notice Creates a new Etches contract
     *
     * @param teamsContract The address of the Teams contract
     */
    constructor(address teamsContract) ERC721("Etches", "ETCH") NodeHandler(teamsContract) {
        teams = teamsContract;
    }
&nbsp;
    /**
     * @notice Creates a new Etch, mints it to the specified address
     *
     * @param to The address to mint the Etch to
     */
    function safeMint(address to, string calldata documentName, string calldata ipfsCid) public virtual override {
        totalSupply.increment();
        uint256 tokenId = totalSupply.current();
&nbsp;
        _safeMint(to, tokenId, "");
&nbsp;
        metadataOf[tokenId] = SEtch({
            creator: _msgSender(),
            documentName: documentName,
            ipfsCid: ipfsCid,
            commentsCount: 0,
            timestamp: block.timestamp
        });
&nbsp;
        emit EtchCreated(tokenId, to, ipfsCid, documentName);
    }
&nbsp;
    /**
     * @notice Comments on an Etch (Ex: Signature, Approval, etc.)
     *
     * @param tokenId The Etch's ID to comment on
     * @param commentIpfsCid The IPFS CID of the comment's document
     *
     * @dev This function can only be called by a user with read permission for the Etch
     */
<span class="fstat-no" title="function not covered" >    function commentOnEtch(uint256 tokenId, string memory commentIpfsCid) external virtual override {</span>
<span class="cstat-no" title="statement not covered" >        require(hasWritePermission(_msgSender(), tokenId), "ETCH: Not allowed to read this Etch")</span>;
&nbsp;
        commentsOf[tokenId] = SComments({commentIpfsCid: commentIpfsCid, timestamp: block.timestamp});
&nbsp;
        metadataOf[tokenId].commentsCount++;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit CommentAdded(tokenId, metadataOf[tokenId].commentsCount, commentsOf[tokenId]);</span>
    }
&nbsp;
    /**
     * @notice Transfers an Etch to the specified team
     *
     * @param tokenId The Etch's ID to transfer
     * @param teamId The team to transfer the Etch to, will revert if the team does not exist
     *
     * @dev This function can only be called by a user with ownership of the Etch
     */
    function transferToTeam(uint256 tokenId, uint256 teamId) external virtual override {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(ITeams(teams).getNumberOfTeamsCreated() &gt;= teamId, "ETCH: Team does not exist");
        _transfer(_msgSender(), teams, tokenId);
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (teamOf[tokenId] &gt; 0) _setTeamPermissions(tokenId, teamOf[tokenId], ITeams.EPermissions.None);
        teamOf[tokenId] = teamId;
        _setTeamPermissions(tokenId, teamId, ITeams.EPermissions.ReadWrite);
&nbsp;
        emit EtchTransferedToTeam(tokenId, _msgSender(), teamId); // Transfer the Etch to the team
    }
&nbsp;
    /**
     * @notice Mints an Etch for the specified team
     *
     * @param teamId The `team` to mint the Etch for, will revert if the `team` does not exist
     *
     * @dev This function can only be called by a user with read/write permission for the `team`
     */
    function safeMintForTeam(uint256 teamId, string calldata documentName, string calldata ipfsCid) external virtual override {
        // TODO: Change to write permission on team
        require(
            ITeams(teams).hasPermission(teamId, _msgSender(), ITeams.EPermissions.ReadWrite),
            "ETCH: Not allowed to mint for this team"
        );
&nbsp;
        safeMint(teams, documentName, ipfsCid);
        uint256 tokenId = totalSupply.current();
&nbsp;
        teamOf[tokenId] = teamId;
        _setTeamPermissions(tokenId, teamId, ITeams.EPermissions.ReadWrite);
        emit EtchTransferedToTeam(tokenId, _msgSender(), teamId); // Transfer the Etch to the team
    }
&nbsp;
    /**
     * @notice Checks if the account has read permission for the `etch`
     *
     * @param account The account to check for read permission
     * @param tokenId The `etch`'s ID to check for read permission
     *
     * @return bool True if the account has read permission for the `etch`
     */
    function hasReadPermission(address account, uint256 tokenId) public view virtual override returns (bool) {
        return _checkPermssion(account, tokenId, ITeams.EPermissions.Read);
    }
&nbsp;
    /**
     * @notice Sets the individual permissions for the Etch
     *
     * @param tokenId The Etch's ID to set the permissions for
     * @param account The account to set the permissions for
     * @param permission The permission to set, See EPermissions for more details
     *
     * @dev This function can only be called by the owner of the Etch
     */
<span class="fstat-no" title="function not covered" >    function setIndividualPermissions(</span>
        uint256 tokenId,
        address account,
        ITeams.EPermissions permission
    ) external virtual override {
<span class="cstat-no" title="statement not covered" >        require(ownerOf(tokenId) == _msgSender(), "ETCH: Not allowed to set permissions for this Etch")</span>;
<span class="cstat-no" title="statement not covered" >        _setIndividualPermissions(tokenId, account, permission)</span>;
    }
&nbsp;
    /**
     * @notice Sets the individual permissions for the Etch (Private, does not check for ownership)
     *
     * @param tokenId The Etch's ID to set the permissions for
     * @param account The account to set the permissions for
     * @param permission The permission to set, See EPermissions for more details
     */
<span class="fstat-no" title="function not covered" >    function _setIndividualPermissions(uint256 tokenId, address account, ITeams.EPermissions permission) private {</span>
        individualPermissionsOf[tokenId][account] = permission;
<span class="cstat-no" title="statement not covered" >        emit InvididualPermissionsUpdated(tokenId, account, permission);</span>
    }
&nbsp;
    /**
     * @notice Sets the team permissions for the Etch
     *
     * @param tokenId The Etch's ID to set the permissions for
     * @param teamId The team to set the permissions for
     * @param permission The permission to set, See EPermissions for more details
     *
     * @dev This function can only be called by the owner of the Etch
     */
<span class="fstat-no" title="function not covered" >    function setTeamPermissions(uint256 tokenId, uint256 teamId, ITeams.EPermissions permission) public virtual override {</span>
<span class="cstat-no" title="statement not covered" >        require(ownerOf(tokenId) == _msgSender(), "ETCH: Not allowed to set permissions for this Etch")</span>;
<span class="cstat-no" title="statement not covered" >        _setTeamPermissions(tokenId, teamId, permission)</span>;
    }
&nbsp;
    /**
     * @notice Sets the team permissions for the Etch (Private, does not check for ownership)
     *
     * @param tokenId The Etch's ID to set the permissions for
     * @param teamId The team to set the permissions for
     * @param permission The permission to set, See EPermissions for more details
     */
    function _setTeamPermissions(uint256 tokenId, uint256 teamId, ITeams.EPermissions permission) private {
        if (indexOfTeamPermissionsOf[tokenId][teamId] &gt; 0)
            teamPermissionsOf[tokenId][indexOfTeamPermissionsOf[tokenId][teamId] - 1].permission = permission;
        else {
            <span class="missing-if-branch" title="else path not taken" >E</span>require(teamPermissionsOf[tokenId].length &lt; 32, "ETCH: Too many teams");
            teamPermissionsOf[tokenId].push(ExternalTeamPermission({teamId: teamId, permission: permission}));
            indexOfTeamPermissionsOf[tokenId][teamId] = teamPermissionsOf[tokenId].length;
        }
        emit TeamPermissionsUpdated(tokenId, teamId, permission);
    }
&nbsp;
    /**
     * @notice Checks if the account has write permission for the Etch
     *
     * @param account The account to check for write permission
     * @param tokenId The Etch's ID to check for write permission
     *
     * @return bool True if the account has write permission for the Etch
     */
    function hasWritePermission(address account, uint256 tokenId) public view virtual override returns (bool) {
        return _checkPermssion(account, tokenId, ITeams.EPermissions.ReadWrite);
    }
&nbsp;
    /**
     * @notice Get the total number of Etches minted
     *
     * @return uint256 The total number of Etches minted
     */
<span class="fstat-no" title="function not covered" >    function getTotalSupply() external view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return totalSupply.current();</span>
    }
&nbsp;
    /**
     * @notice Override of the ERC721 implementation to allow for the teams contract to be the owner of the Etch, through User, Team, or Organisation ownership
     *
     * @param tokenId The Etch's ID to check the owner of
     *
     * @return address The owner of the Etch
     */
    function _ownerOf(uint256 tokenId) internal view virtual override returns (address) {
        address owner = _owners[tokenId];
&nbsp;
        // is owner by the teams contract.
        // We now need to get which team this UINT is part of...
        if (owner == teams) return ITeams(teams).ownerOf(teamOf[tokenId]);
        else return owner;
    }
&nbsp;
    /**
     * @notice Checks if the account has the specified permission for the Etch
     *
     * @param account The account to check for the permission
     * @param tokenId  The Etch's ID to check for the permission
     * @param permission The permission to check for
     *
     * @return bool True if the account has the specified permission for the Etch
     */
    function _checkPermssion(
        address account,
        uint256 tokenId,
        ITeams.EPermissions permission
    ) internal view virtual returns (bool) {
        if (
<span class="branch-0 cbranch-no" title="branch not covered" >            account == ownerOf(tokenId) ||</span>
            individualPermissionsOf[tokenId][account] &gt;= permission ||
            (teamOf[tokenId] &gt; 0 &amp;&amp; ITeams(teams).hasPermission(teamOf[tokenId], account, permission))
        ) return true;
&nbsp;
        // Check if the account has the permission through a team (Has to loop through all teams)
        uint256 len = teamPermissionsOf[tokenId].length;
        for (uint256 i = 0; i &lt; len; i++)
            <span class="missing-if-branch" title="if path not taken" >I</span>if (
                teamPermissionsOf[tokenId][i].permission &gt;= permission &amp;&amp;
                ITeams(teams).hasPermission(teamPermissionsOf[tokenId][i].teamId, account, permission)
            ) <span class="cstat-no" title="statement not covered" >return true;</span>
&nbsp;
        return false;
    }
&nbsp;
    // Should we implement a safety check like this ?
    // function _beforeTokenTransfer(
    //     address from,
    //     address to,
    //     uint256 firstTokenId,
    //     uint256 batchSize
    // ) internal virtual override {
    //     require(
    //         from == address(0) || to != teams,
    //         "ETCH: Cannot transfer to teams contract"
    //     );
    // }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Aug 29 2023 15:16:38 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
